<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aqliy Sinov O'yini</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Mochiy Pop One', sans-serif;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        body {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            overflow-x: hidden;
        }
        .card-flip {
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        .card-flip.flipped {
            transform: rotateY(180deg);
        }
        .card-front, .card-back {
            backface-visibility: hidden;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .card-back {
            transform: rotateY(180deg);
        }
        @keyframes pulse-orange {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 140, 0, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(255, 140, 0, 0); }
        }
        .pulse-orange {
            animation: pulse-orange 2s infinite;
        }
        input[type="text"]:disabled, input[type="number"]:disabled {
            opacity: 0.6;
        }
        .glow-text {
            text-shadow: 0 0 10px rgba(255, 140, 0, 0.5);
        }
        .reset-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        .sequence-box {
            transition: all 0.3s ease;
        }
        .sequence-box.highlight {
            transform: scale(1.2);
            background: linear-gradient(135deg, #ff8c00 0%, #ff6b00 100%);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="max-w-6xl w-full">
        <!-- Header -->
        <div class="bg-black/50 backdrop-blur-sm border-2 border-orange-500 rounded-t-2xl p-6">
            <h1 class="text-4xl font-bold text-center text-white glow-text mb-4">üß† AQLIY SINOV O'YINI</h1>
            <div class="flex justify-between items-center">
                <div class="text-white">
                    <span class="text-lg">Bosqich: </span>
                    <span id="currentStage" class="text-2xl font-bold text-orange-500">1/6</span>
                </div>
                <div class="text-white">.
                    <span class="text-lg">Vaqt: </span>
                    <span id="timer" class="text-3xl font-bold text-orange-500 pulse-orange">03:20</span>
                </div>
                <div class="text-white">
                    <span class="text-lg">Ball: </span>
                    <span id="score" class="text-2xl font-bold text-orange-500">0</span>
                </div>
            </div>
            <!-- Progress Bar -->
            <div class="w-full bg-gray-700 h-3 rounded-full mt-4 overflow-hidden">
                <div id="progressBar" class="bg-gradient-to-r from-orange-500 to-orange-600 h-full transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>

        <!-- Game Container -->
        <div class="bg-white rounded-b-2xl shadow-2xl p-8 min-h-[600px] flex flex-col items-center justify-center">
            
            <!-- Stage 1: Code Display -->
            <div id="stage1" class="text-center w-full">
                <h2 class="text-3xl font-bold mb-6 text-gray-800">Bosqich 1: Kodni eslab qoling</h2>
                <p class="text-gray-600 mb-8">Quyidagi 6 raqamli kodni eslab qoling. U oxirida kerak bo'ladi!</p>
                <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-2xl p-12 mb-8 inline-block">
                    <div id="codeDisplay" class="text-7xl font-bold text-white tracking-widest"></div>
                </div>
                <div id="codeTimer" class="text-2xl font-semibold text-orange-600 mb-6">Ko'rsatish: 10 soniya</div>
                <button id="startBtn" class="bg-black text-white px-12 py-4 rounded-xl text-xl font-semibold hover:bg-gray-800 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    Keyingi Bosqichga O'tish
                </button>
            </div>

            <!-- Stage 2: Memory Game -->
            <div id="stage2" class="hidden w-full">
                <h2 class="text-3xl font-bold mb-4 text-gray-800 text-center">Bosqich 2: Bir xil juftliklarni toping</h2>
                <p class="text-gray-600 mb-6 text-center">Barcha juftliklarni toping!</p>
                <div id="memoryGrid" class="grid grid-cols-5 gap-3 max-w-2xl mx-auto mb-6"></div>
                <div class="text-center">
                    <div class="text-xl font-semibold text-orange-600">Topildi: <span id="foundPairs">0</span>/10</div>
                </div>
            </div>

            <!-- Stage 3: Math Problems -->
            <div id="stage3" class="hidden w-full max-w-2xl mx-auto">
                <h2 class="text-3xl font-bold mb-4 text-gray-800 text-center">Bosqich 3: Matematik Misollar</h2>
                <p class="text-gray-600 mb-6 text-center">10 ta matematik masalani yeching!</p>
                <div class="bg-gray-100 rounded-xl p-8">
                    <div class="text-center mb-6">
                        <div class="text-xl text-gray-700 mb-2">Misol <span id="mathQuestion">1</span>/10</div>
                        <div id="mathProblem" class="text-5xl font-bold text-gray-800 mb-6"></div>
                        <input type="number" id="mathAnswer" class="w-full text-center text-3xl font-semibold border-4 border-orange-500 rounded-xl p-4 focus:outline-none focus:ring-4 focus:ring-orange-300" placeholder="Javob" autocomplete="off">
                    </div>
                    <button id="mathSubmit" class="w-full bg-orange-500 text-white px-8 py-4 rounded-xl text-xl font-semibold hover:bg-orange-600 transition-all transform hover:scale-105">
                        Tasdiqlash
                    </button>
                </div>
            </div>

            <!-- Stage 4: Color Stroop Test -->
            <div id="stage4" class="hidden w-full max-w-2xl mx-auto">
                <h2 class="text-3xl font-bold mb-4 text-gray-800 text-center">Bosqich 4: Rang va Nomni Aniqlash</h2>
                <p class="text-gray-600 mb-6 text-center">Matnning RANGINI tanlang, nomini emas!</p>
                <div class="bg-gray-100 rounded-xl p-8">
                    <div class="text-center mb-8">
                        <div class="text-xl text-gray-700 mb-4">Savol <span id="stroopQuestion">1</span>/10</div>
                        <div id="stroopWord" class="text-7xl font-bold mb-8"></div>
                        <div class="grid grid-cols-2 gap-4">
                            <button class="stroop-btn bg-red-500 hover:bg-red-600 text-white px-8 py-6 rounded-xl text-xl font-semibold transition-all transform hover:scale-105" data-color="red">
                                Qizil
                            </button>
                            <button class="stroop-btn bg-blue-500 hover:bg-blue-600 text-white px-8 py-6 rounded-xl text-xl font-semibold transition-all transform hover:scale-105" data-color="blue">
                                Ko'k
                            </button>
                            <button class="stroop-btn bg-green-500 hover:bg-green-600 text-white px-8 py-6 rounded-xl text-xl font-semibold transition-all transform hover:scale-105" data-color="green">
                                Yashil
                            </button>
                            <button class="stroop-btn bg-yellow-500 hover:bg-yellow-600 text-white px-8 py-6 rounded-xl text-xl font-semibold transition-all transform hover:scale-105" data-color="yellow">
                                Sariq
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stage 5: Number Sequence Memory -->
            <div id="stage5" class="hidden w-full max-w-3xl mx-auto">
                <h2 class="text-3xl font-bold mb-4 text-gray-800 text-center">Bosqich 5: Raqamlar Ketma-ketligini Eslab Qoling</h2>
                <p class="text-gray-600 mb-6 text-center">Raqamlarning ko'rsatilish tartibini eslab qoling va to'g'ri bosing!</p>
                <div class="bg-gray-100 rounded-xl p-8">
                    <div class="text-center mb-4">
                        <div class="text-xl text-gray-700 mb-2">Level: <span id="sequenceLevel">1</span>/5</div>
                    </div>
                    <div id="sequenceGrid" class="grid grid-cols-4 gap-4 max-w-md mx-auto mb-6"></div>
                    <div id="sequenceMessage" class="text-center text-lg font-semibold text-orange-600 min-h-[30px]"></div>
                    <button id="sequenceStart" class="w-full bg-orange-500 text-white px-8 py-4 rounded-xl text-xl font-semibold hover:bg-orange-600 transition-all transform hover:scale-105">
                        Boshlash
                    </button>
                </div>
            </div>

            <!-- Stage 6: Code Entry -->
            <div id="stage6" class="hidden w-full max-w-2xl mx-auto">
                <h2 class="text-3xl font-bold mb-4 text-gray-800 text-center">Bosqich 6: Kodni kiriting</h2>
                <p class="text-gray-600 mb-8 text-center">Birinchi bosqichda ko'rgan 6 raqamli kodingizni kiriting!</p>
                <div class="bg-gray-100 rounded-xl p-8">
                    <input type="text" id="codeInput" maxlength="6" class="w-full text-center text-5xl font-bold border-4 border-orange-500 rounded-xl p-6 focus:outline-none focus:ring-4 focus:ring-orange-300 tracking-widest" placeholder="------" autocomplete="off">
                    <button id="codeSubmit" class="w-full mt-6 bg-orange-500 text-white px-8 py-4 rounded-xl text-xl font-semibold hover:bg-orange-600 transition-all transform hover:scale-105">
                        Tekshirish
                    </button>
                </div>
            </div>

            <!-- Victory Screen -->
            <div id="victory" class="hidden text-center w-full">
                <div class="text-8xl mb-6">üéâ</div>
                <h2 class="text-5xl font-bold mb-6 text-green-600">TABRIKLAYMAN!</h2>
                <p class="text-2xl text-gray-700 mb-8">Siz barcha bosqichlarni muvaffaqiyatli yakunladingiz!</p>
                <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-2xl p-8 text-white mb-8 inline-block">
                    <div class="text-xl mb-2">Yakuniy Ball</div>
                    <div id="finalScore" class="text-6xl font-bold">0</div>
                    <div class="text-xl mt-4">Sarflangan vaqt: <span id="timeUsed"></span></div>
                </div>
                <button onclick="location.reload()" class="bg-black text-white px-12 py-4 rounded-xl text-xl font-semibold hover:bg-gray-800 transition-all transform hover:scale-105">
                    Qaytadan O'ynash
                </button>
            </div>

            <!-- Game Over Screen -->
            <div id="gameover" class="hidden text-center w-full">
                <div class="text-8xl mb-6">‚è∞</div>
                <h2 class="text-5xl font-bold mb-6 text-red-600">VAQT TUGADI!</h2>
                <p class="text-2xl text-gray-700 mb-8">Afsuski, siz o'yinni yakunlay olmadingiz.</p>
                <div class="bg-gray-200 rounded-2xl p-8 mb-8 inline-block">
                    <div class="text-xl mb-2 text-gray-700">To'plagan ballingiz</div>
                    <div id="gameoverScore" class="text-5xl font-bold text-gray-800">0</div>
                </div>
                <button onclick="location.reload()" class="bg-black text-white px-12 py-4 rounded-xl text-xl font-semibold hover:bg-gray-800 transition-all transform hover:scale-105">
                    Qaytadan Urinish
                </button>
            </div>
        </div>
    </div>

    <!-- Floating Reset Button -->
    <button onclick="if(confirm('O\'yinni qayta boshlamoqchimisiz?')) location.reload()" class="reset-btn bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-full text-lg font-semibold shadow-lg hover:shadow-xl transition-all transform hover:scale-110">
        üîÑ Qayta boshlash
    </button>

    <script>
        // MAXSUS HIMOYA - Copy/Paste va DevTools to'liq bloklangan
        document.addEventListener('contextmenu', e => e.preventDefault());
        
        // Barcha klaviatura kombinatsiyalarini bloklash
        document.addEventListener('keydown', e => {
            // DevTools va boshqa kombinatsiyalar
            if (e.key === 'F12' || 
                (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'i' || e.key === 'C' || e.key === 'c' || e.key === 'J' || e.key === 'j')) ||
                (e.ctrlKey && (e.key === 'u' || e.key === 'U')) ||
                (e.metaKey && e.shiftKey && (e.key === 'I' || e.key === 'i' || e.key === 'C' || e.key === 'c' || e.key === 'J' || e.key === 'j')) ||
                (e.metaKey && (e.key === 'u' || e.key === 'U'))) {
                e.preventDefault();
                return false;
            }
            
            // Copy, Cut, Paste kombinatsiyalarini bloklash
            if ((e.ctrlKey || e.metaKey) && (e.key === 'c' || e.key === 'C' || e.key === 'x' || e.key === 'X' || e.key === 'v' || e.key === 'V')) {
                e.preventDefault();
                return false;
            }
        });

        // Copy/Paste eventlarini to'liq bloklash
        document.addEventListener('copy', e => e.preventDefault());
        document.addEventListener('cut', e => e.preventDefault());
        document.addEventListener('paste', e => e.preventDefault());
        
        // Inputlarga ham paste bloklash
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('input, textarea').forEach(element => {
                element.addEventListener('paste', e => e.preventDefault());
                element.addEventListener('drop', e => e.preventDefault());
            });
        });

        // Sichqoncha oynadan chiqsa o'yinni qayta boshlash
        let mouseLeftWindow = false;
        let gameStarted = false;
        
        // document.addEventListener('mouseleave', () => {
        //     if (gameStarted && !document.hidden) {
        //         if (confirm('Sichqoncha oynadan chiqdi! O\'yin qayta boshlanadi.')) {
        //             location.reload();
        //         } else {
        //             location.reload();
        //         }
        //     }
        // });
        
        // Tabdan chiqsa ham tekshirish
        // document.addEventListener('visibilitychange', () => {
        //     if (document.hidden && gameStarted) {
        //         if (confirm('Siz boshqa tabga o\'tdingiz! O\'yin qayta boshlanadi.')) {
        //             location.reload();
        //         } else {
        //             location.reload();
        //         }
        //     }
        // });

        // ============= GAME STATE =============
        const TOTAL_TIME = 200; // 200 sekund
        
        const gameState = {
            currentStage: 1,
            score: 0,
            timeRemaining: TOTAL_TIME,
            timerInterval: null,
            secretCode: '',
            memoryCards: [],
            flippedCards: [],
            matchedPairs: 0,
            mathProblems: [],
            currentMathIndex: 0,
            stroopTests: [],
            currentStroopIndex: 0,
            sequenceLevel: 1,
            currentSequence: [],
            userSequence: [],
            sequenceShowing: false
        };

        // ============= TIMER =============
        function startTimer() {
            gameStarted = true;
            gameState.timerInterval = setInterval(() => {
                gameState.timeRemaining--;
                
                const minutes = Math.floor(gameState.timeRemaining / 60);
                const seconds = gameState.timeRemaining % 60;
                document.getElementById('timer').textContent = 
                    `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                
                if (gameState.timeRemaining <= 0) {
                    endGame(false);
                }
            }, 1000);
        }

        function updateProgress() {
            document.getElementById('currentStage').textContent = `${gameState.currentStage}/6`;
            document.getElementById('score').textContent = gameState.score;
            const progress = (gameState.currentStage / 6) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        // ============= STAGE 1: CODE DISPLAY =============
        function initStage1() {
            gameState.secretCode = String(Math.floor(100000 + Math.random() * 900000));
            document.getElementById('codeDisplay').textContent = gameState.secretCode;
            
            let countdown = 10;
            const timerEl = document.getElementById('codeTimer');
            
            const countdownInterval = setInterval(() => {
                countdown--;
                timerEl.textContent = `Ko'rsatish: ${countdown} soniya`;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    document.getElementById('codeDisplay').textContent = '******';
                    timerEl.textContent = 'Kod yashirildi!';
                    document.getElementById('startBtn').disabled = false;
                }
            }, 1000);
            
            document.getElementById('startBtn').onclick = () => {
                startTimer();
                nextStage();
            };
        }

        // ============= STAGE 2: MEMORY GAME =============
        function initStage2() {
            const emojis = ['üéÆ', 'üé®', 'üé≠', 'üé™', 'üéØ', 'üé≤', 'üé∏', 'üé∫', 'üéª', 'üéπ'];
            gameState.memoryCards = [...emojis, ...emojis].sort(() => Math.random() - 0.5);
            gameState.flippedCards = [];
            gameState.matchedPairs = 0;
            
            const grid = document.getElementById('memoryGrid');
            grid.innerHTML = '';
            
            gameState.memoryCards.forEach((emoji, index) => {
                const card = document.createElement('div');
                card.className = 'relative h-24 cursor-pointer';
                card.innerHTML = `
                    <div class="card-flip w-full h-full" data-index="${index}">
                        <div class="card-front bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl flex items-center justify-center text-4xl font-bold text-white shadow-lg">
                            ?
                        </div>
                        <div class="card-back bg-white rounded-xl flex items-center justify-center text-5xl shadow-lg border-4 border-orange-500">
                            ${emoji}
                        </div>
                    </div>
                `;
                
                card.onclick = () => handleCardClick(index);
                grid.appendChild(card);
            });
        }

        function handleCardClick(index) {
            if (gameState.flippedCards.length >= 2) return;
            if (gameState.flippedCards.includes(index)) return;
            
            const card = document.querySelector(`[data-index="${index}"]`);
            if (card.classList.contains('flipped')) return;
            
            card.classList.add('flipped');
            gameState.flippedCards.push(index);
            
            if (gameState.flippedCards.length === 2) {
                const [first, second] = gameState.flippedCards;
                
                if (gameState.memoryCards[first] === gameState.memoryCards[second]) {
                    gameState.matchedPairs++;
                    gameState.score += 50;
                    updateProgress();
                    document.getElementById('foundPairs').textContent = gameState.matchedPairs;
                    gameState.flippedCards = [];
                    
                    if (gameState.matchedPairs === 10) {
                        setTimeout(() => nextStage(), 500);
                    }
                } else {
                    setTimeout(() => {
                        document.querySelector(`[data-index="${first}"]`).classList.remove('flipped');
                        document.querySelector(`[data-index="${second}"]`).classList.remove('flipped');
                        gameState.flippedCards = [];
                    }, 1000);
                }
            }
        }

        // ============= STAGE 3: MATH PROBLEMS =============
        function initStage3() {
            gameState.mathProblems = [];
            gameState.currentMathIndex = 0;
            
            for (let i = 0; i < 10; i++) {
                const a = Math.floor(Math.random() * 50) + 10;
                const b = Math.floor(Math.random() * 50) + 10;
                const ops = ['+', '-', '*'];
                const op = ops[Math.floor(Math.random() * ops.length)];
                
                let answer;
                if (op === '+') answer = a + b;
                else if (op === '-') answer = a - b;
                else answer = a * b;
                
                gameState.mathProblems.push({
                    question: `${a} ${op} ${b}`,
                    answer: answer
                });
            }
            
            showMathProblem();
            
            const input = document.getElementById('mathAnswer');
            input.value = '';
            input.focus();
            
            document.getElementById('mathSubmit').onclick = checkMathAnswer;
            input.onkeypress = (e) => {
                if (e.key === 'Enter') checkMathAnswer();
            };
        }

        function showMathProblem() {
            const problem = gameState.mathProblems[gameState.currentMathIndex];
            document.getElementById('mathProblem').textContent = problem.question;
            document.getElementById('mathQuestion').textContent = gameState.currentMathIndex + 1;
            document.getElementById('mathAnswer').value = '';
        }

        function checkMathAnswer() {
            const input = document.getElementById('mathAnswer');
            const userAnswer = parseInt(input.value);
            const problem = gameState.mathProblems[gameState.currentMathIndex];
            
            if (userAnswer === problem.answer) {
                gameState.score += 100;
                updateProgress();
                gameState.currentMathIndex++;
                
                if (gameState.currentMathIndex >= 10) {
                    setTimeout(() => nextStage(), 300);
                } else {
                    showMathProblem();
                    input.focus();
                }
            } else {
                alert('Noto\'g\'ri javob! Qaytadan urinib ko\'ring.');
                input.value = '';
                input.focus();
            }
        }

        // ============= STAGE 4: STROOP TEST =============
        function initStage4() {
            const colors = [
                { text: 'QIZIL', value: 'red', class: 'text-red-500' },
                { text: 'KO\'K', value: 'blue', class: 'text-blue-500' },
                { text: 'YASHIL', value: 'green', class: 'text-green-500' },
                { text: 'SARIQ', value: 'yellow', class: 'text-yellow-500' }
            ];
            
            gameState.stroopTests = [];
            gameState.currentStroopIndex = 0;
            
            for (let i = 0; i < 10; i++) {
                const wordColor = colors[Math.floor(Math.random() * colors.length)];
                const displayColor = colors[Math.floor(Math.random() * colors.length)];
                
                gameState.stroopTests.push({
                    text: wordColor.text,
                    color: displayColor.value,
                    colorClass: displayColor.class
                });
            }
            
            showStroopTest();
            
            document.querySelectorAll('.stroop-btn').forEach(btn => {
                btn.onclick = () => {
                    const test = gameState.stroopTests[gameState.currentStroopIndex];
                    
                    if (btn.dataset.color === test.color) {
                        gameState.score += 100;
                        updateProgress();
                        gameState.currentStroopIndex++;
                        
                        if (gameState.currentStroopIndex >= 10) {
                            setTimeout(() => nextStage(), 300);
                        } else {
                            showStroopTest();
                        }
                    } else {
                        alert('Noto\'g\'ri! Matnning RANGINI tanlang.');
                    }
                };
            });
        }

        function showStroopTest() {
            const test = gameState.stroopTests[gameState.currentStroopIndex];
            const wordEl = document.getElementById('stroopWord');
            wordEl.textContent = test.text;
            wordEl.className = `text-7xl font-bold mb-8 ${test.colorClass}`;
            document.getElementById('stroopQuestion').textContent = gameState.currentStroopIndex + 1;
        }

        // ============= STAGE 5: NUMBER SEQUENCE MEMORY =============
        function initStage5() {
            gameState.sequenceLevel = 1;
            gameState.currentSequence = [];
            gameState.userSequence = [];
            
            const grid = document.getElementById('sequenceGrid');
            grid.innerHTML = '';
            
            // 16 ta quti yaratish
            for (let i = 0; i < 16; i++) {
                const box = document.createElement('div');
                box.className = 'sequence-box bg-gray-300 rounded-xl h-20 flex items-center justify-center text-3xl font-bold cursor-pointer hover:bg-gray-400 transition-all';
                box.textContent = i + 1;
                box.dataset.index = i;
                box.onclick = () => handleSequenceClick(i);
                grid.appendChild(box);
            }
            
            document.getElementById('sequenceStart').onclick = startSequence;
            document.getElementById('sequenceMessage').textContent = '"Boshlash" tugmasini bosing';
        }

        function startSequence() {
            gameState.userSequence = [];
            gameState.currentSequence = [];
            
            // Level ga qarab ketma-ketlik uzunligi (3, 4, 5, 6, 7)
            const length = 2 + gameState.sequenceLevel;
            
            for (let i = 0; i < length; i++) {
                gameState.currentSequence.push(Math.floor(Math.random() * 16));
            }
            
            document.getElementById('sequenceStart').disabled = true;
            document.getElementById('sequenceMessage').textContent = 'Kuzating...';
            
            // Ketma-ketlikni ko'rsatish
            showSequence(0);
        }

        function showSequence(index) {
            if (index >= gameState.currentSequence.length) {
                document.getElementById('sequenceMessage').textContent = 'Endi siz bosing!';
                document.getElementById('sequenceStart').disabled = false;
                gameState.sequenceShowing = false;
                return;
            }
            
            gameState.sequenceShowing = true;
            const boxIndex = gameState.currentSequence[index];
            const boxes = document.querySelectorAll('.sequence-box');
            const box = boxes[boxIndex];
            
            box.classList.add('highlight');
            
            setTimeout(() => {
                box.classList.remove('highlight');
                setTimeout(() => showSequence(index + 1), 300);
            }, 600);
        }

        function handleSequenceClick(index) {
            if (gameState.sequenceShowing) return;
            if (document.getElementById('sequenceStart').disabled) return;
            
            gameState.userSequence.push(index);
            
            // Tugmani vaqtincha highlight qilish
            const boxes = document.querySelectorAll('.sequence-box');
            boxes[index].classList.add('highlight');
            setTimeout(() => boxes[index].classList.remove('highlight'), 200);
            
            // Tekshirish
            const currentIndex = gameState.userSequence.length - 1;
            
            if (gameState.userSequence[currentIndex] !== gameState.currentSequence[currentIndex]) {
                document.getElementById('sequenceMessage').textContent = 'Xato! Qaytadan urinib ko\'ring.';
                gameState.userSequence = [];
                setTimeout(() => {
                    document.getElementById('sequenceMessage').textContent = '"Boshlash" tugmasini bosing';
                }, 1500);
                return;
            }
            
            // To'g'ri ketma-ketlik tugadi
            if (gameState.userSequence.length === gameState.currentSequence.length) {
                gameState.score += 150;
                updateProgress();
                gameState.sequenceLevel++;
                
                if (gameState.sequenceLevel > 5) {
                    document.getElementById('sequenceMessage').textContent = 'Barcha levellar yakunlandi!';
                    setTimeout(() => nextStage(), 1000);
                } else {
                    document.getElementById('sequenceLevel').textContent = gameState.sequenceLevel;
                    document.getElementById('sequenceMessage').textContent = 'Ajoyib! Keyingi level...';
                    setTimeout(() => {
                        document.getElementById('sequenceMessage').textContent = '"Boshlash" tugmasini bosing';
                    }, 1500);
                }
            }
        }

        // ============= STAGE 6: CODE ENTRY =============
        function initStage6() {
            const input = document.getElementById('codeInput');
            input.value = '';
            input.focus();
            
            document.getElementById('codeSubmit').onclick = () => {
                const enteredCode = input.value.trim();
                
                if (enteredCode === gameState.secretCode) {
                    gameState.score += 300;
                    updateProgress();
                    endGame(true);
                } else {
                    alert('Kod noto\'g\'ri! Qaytadan urinib ko\'ring.');
                    input.value = '';
                    input.focus();
                }
            };
            
            input.onkeypress = (e) => {
                if (e.key === 'Enter') document.getElementById('codeSubmit').click();
            };
        }

        // ============= STAGE MANAGEMENT =============
        function nextStage() {
            document.getElementById('stage' + gameState.currentStage).classList.add('hidden');
            gameState.currentStage++;
            document.getElementById('stage' + gameState.currentStage).classList.remove('hidden');
            updateProgress();
            
            switch(gameState.currentStage) {
                case 2: initStage2(); break;
                case 3: initStage3(); break;
                case 4: initStage4(); break;
                case 5: initStage5(); break;
                case 6: initStage6(); break;
            }
        }

        function endGame(victory) {
            gameStarted = false;
            clearInterval(gameState.timerInterval);
            
            document.getElementById('stage' + gameState.currentStage).classList.add('hidden');
            
            if (victory) {
                document.getElementById('victory').classList.remove('hidden');
                document.getElementById('finalScore').textContent = gameState.score;
                const timeUsed = TOTAL_TIME - gameState.timeRemaining;
                const minutes = Math.floor(timeUsed / 60);
                const seconds = timeUsed % 60;
                document.getElementById('timeUsed').textContent = 
                    `${minutes}:${String(seconds).padStart(2, '0')}`;
            } else {
                document.getElementById('gameover').classList.remove('hidden');
                document.getElementById('gameoverScore').textContent = gameState.score;
            }
        }

        // ============= INITIALIZE =============
        initStage1();
    </script>
</body>

</html>
